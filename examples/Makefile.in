###
###	@configure_input@
###

.SUFFIXES:	.ml .mli .cmx .cmi .cmo .cmxa .cma .c .o

INSTALLDIR	= @INSTALLDIR@

OCBYTE		= @OCAMLC@
OCOPT		= @OCAMLOPT@

OC		= @OCAMLC@
CC		= @CC@

LIBEVENTDIR = "$(shell ocamlfind query liboevent)"

FLAGS		= -I .. -I $(LIBEVENTDIR)
LFLAGS		= -I .. -I $(LIBEVENTDIR) -ccopt -L..
LIBS		= 

OCURLLIB	= curl.cma unix.cma liboevent.cma
OCURLOPTLIB	= curl.cmxa unix.cmxa liboevent.cmxa

ifeq (@OCAMLBEST@,opt)
TARGETS	= ocurl ocurl.opt oput oput.opt ominimal ominimal.opt ossl ossl.opt omulti omulti.opt
else
TARGETS = ocurl oput ominimal ossl omulti
endif

all:
		@$(MAKE) depend
		@$(MAKE) targets

targets:	$(TARGETS)

%: %.cmo
		$(OCBYTE) -custom $(LFLAGS) $(OCURLLIB) $< -o $@

%.opt: %.cmx
		$(OCOPT) $(LFLAGS) $(OCURLOPTLIB) $< -o $@

.ml.cmx:
		$(OCOPT) -c $(FLAGS) $< -o $@

.mli.cmi:
		$(OCBYTE) -c $(FLAGS) $< -o $@

.ml.cmo:
		$(OCBYTE) -c $(FLAGS) $< -o $@

clean:
		@rm -f $(TARGETS) *~ *.cm* *.o *.a .depend core

depend:
		@ocamldep *.mli *.ml > .depend

ifeq ($(wildcard .depend),.depend)
ifneq ($(MAKECMDGOALS),clean)
include .depend
endif
endif
