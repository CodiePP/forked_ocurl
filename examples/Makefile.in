###
###	@configure_input@
###

.PHONY: clean
.PRECIOUS: %.cmx %.cmo %.cmi
.SUFFIXES: .ml .mli .cmx .cmi .cmo

OCBYTE		= @OCAMLC@ -thread
OCOPT		= @OCAMLOPT@ -thread

FLAGS		= -I .. 
LFLAGS		= -I .. -ccopt -L..

OCURLLIB	= curl.cma unix.cma threads.cma
OCURLOPTLIB	= curl.cmxa unix.cmxa threads.cmxa

ifeq (@OCAMLBEST@,opt)
TARGETS	= ocurl ocurl.opt oput oput.opt ominimal ominimal.opt ossl ossl.opt \
	ocurl_test_threads ocurl_test_threads.opt opar opar.opt test_cb_exn.opt
else
TARGETS = ocurl oput ominimal ossl ocurl_test_threads opar test_cb_exn
endif

all:	$(TARGETS)

%: %.cmo
		$(OCBYTE) -custom $(LFLAGS) $(OCURLLIB) $< -o $@

%.opt: %.cmx
		$(OCOPT) $(LFLAGS) $(OCURLOPTLIB) $< -o $@

.ml.cmx:
		$(OCOPT) -c $(FLAGS) $< -o $@

.mli.cmi:
		$(OCBYTE) -c $(FLAGS) $< -o $@

.ml.cmo:
		$(OCBYTE) -c $(FLAGS) $< -o $@

clean:
		@rm -f $(TARGETS) *.cm* *.o *.a
